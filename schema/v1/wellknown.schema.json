{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://diffdelta.io/schema/v1/wellknown.schema.json",
  "title": "DiffDelta Well-Known Manifest (v1)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "service",
    "schema_version",
    "generated_at",
    "endpoints",
    "polling",
    "capabilities",
    "sources_supported",
    "limits"
  ],
  "properties": {
    "service": { "type": "string", "minLength": 1, "maxLength": 64 },
    "schema_version": { "type": "string", "pattern": "^1\\.[0-9]+\\.[0-9]+$" },
    "generated_at": { "type": "string", "format": "date-time" },

    "endpoints": {
      "type": "object",
      "additionalProperties": false,
      "required": ["diff_latest", "known_issues", "healthz", "diff_by_source_template", "schemas"],
      "properties": {
        "diff_latest": { "type": "string", "format": "uri" },
        "known_issues": { "type": "string", "format": "uri" },
        "healthz": { "type": "string", "format": "uri" },
        "diff_by_source_template": { "type": "string", "format": "uri" },
        "schemas": {
          "type": "object",
          "additionalProperties": false,
          "required": ["diff", "known_issues", "wellknown"],
          "properties": {
            "diff": { "type": "string", "format": "uri" },
            "known_issues": { "type": "string", "format": "uri" },
            "wellknown": { "type": "string", "format": "uri" }
          }
        }
      }
    },

    "polling": {
      "type": "object",
      "additionalProperties": false,
      "required": ["recommended_ttl_sec", "max_ttl_sec"],
      "properties": {
        "recommended_ttl_sec": { "type": "integer", "minimum": 15, "maximum": 3600 },
        "max_ttl_sec": { "type": "integer", "minimum": 15, "maximum": 86400 },
        "notes": { "type": "string", "maxLength": 800 }
      }
    },

    "capabilities": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "etag_supported",
        "cursor_supported",
        "known_issues_supported",
        "per_source_endpoints",
        "webhooks_supported",
        "telemetry_opt_in"
      ],
      "properties": {
        "etag_supported": { "type": "boolean" },
        "cursor_supported": { "type": "boolean" },
        "known_issues_supported": { "type": "boolean" },
        "per_source_endpoints": { "type": "boolean" },
        "webhooks_supported": { "type": "boolean" },
        "telemetry_opt_in": { "type": "boolean" }
      }
    },

    "sources_supported": {
      "type": "array",
      "minItems": 1,
      "uniqueItems": true,
      "items": { "type": "string", "pattern": "^[a-z0-9_\\-]{2,32}$" }
    },

    "limits": {
      "type": "object",
      "additionalProperties": false,
      "required": ["max_items_per_bucket", "max_summary_chars", "target_max_payload_kb"],
      "properties": {
        "max_items_per_bucket": { "type": "integer", "minimum": 1, "maximum": 200 },
        "max_summary_chars": { "type": "integer", "minimum": 60, "maximum": 5000 },
        "target_max_payload_kb": { "type": "integer", "minimum": 10, "maximum": 2000 }
      }
    }
  }
}
