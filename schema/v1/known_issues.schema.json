{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://diffdelta.io/schema/v1/known_issues.schema.json",
  "title": "DiffDelta Known Issues (v1)",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "generated_at", "issues"],
  "properties": {
    "schema_version": { "type": "string", "pattern": "^1\\.[0-9]+\\.[0-9]+$" },
    "generated_at": { "type": "string", "format": "date-time" },
    "issues": {
      "type": "array",
      "maxItems": 200,
      "items": { "$ref": "#/$defs/knownIssue" }
    }
  },
  "$defs": {
    "knownIssue": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "issue_key",
        "status",
        "severity",
        "scope",
        "summary",
        "first_seen_at",
        "last_updated_at",
        "sources",
        "workarounds"
      ],
      "properties": {
        "issue_key": { "type": "string", "pattern": "^[a-z0-9_\\-]{3,64}$" },
        "status": { "type": "string", "enum": ["active", "monitoring", "resolved"] },

        "severity": { "type": "string", "enum": ["low", "medium", "high", "critical"] },

        "scope": {
          "type": "object",
          "additionalProperties": false,
          "required": ["level"],
          "properties": {
            "level": { "type": "string", "enum": ["global", "source", "platform", "sdk", "integration"] },
            "ref": {
              "type": "string",
              "maxLength": 64,
              "description": "Optional scope target identifier, e.g. moltbook, github, hn, docs, cloudflare, python-sdk"
            }
          }
        },

        "summary": { "type": "string", "minLength": 1, "maxLength": 240 },
        "details": { "type": "string", "maxLength": 1200 },

        "first_seen_at": { "type": "string", "format": "date-time" },
        "last_updated_at": { "type": "string", "format": "date-time" },

        "signals": {
          "type": "array",
          "maxItems": 6,
          "uniqueItems": true,
          "items": {
            "type": "string",
            "enum": [
              "auth",
              "endpoint",
              "bug",
              "workaround",
              "fix",
              "release",
              "breaking_change",
              "security",
              "outage",
              "rate_limit",
              "tooling",
              "policy",
              "discussion"
            ]
          }
        },

        "sources": {
          "type": "array",
          "minItems": 1,
          "maxItems": 10,
          "items": { "$ref": "#/$defs/sourceRef" }
        },

        "workarounds": {
          "type": "array",
          "maxItems": 5,
          "items": { "$ref": "#/$defs/workaround" }
        },

        "resolution": { "$ref": "#/$defs/resolution" }
      }
    },

    "sourceRef": {
      "type": "object",
      "additionalProperties": false,
      "required": ["source", "url"],
      "properties": {
        "source": { "type": "string", "pattern": "^[a-z0-9_]{2,32}$" },
        "url": { "type": "string", "format": "uri" },
        "note": { "type": "string", "maxLength": 180 }
      }
    },

    "workaround": {
      "type": "object",
      "additionalProperties": false,
      "required": ["text"],
      "properties": {
        "text": { "type": "string", "minLength": 1, "maxLength": 280 },
        "url": { "type": "string", "format": "uri" }
      }
    },

    "resolution": {
      "type": "object",
      "additionalProperties": false,
      "required": ["status", "note", "resolved_at"],
      "properties": {
        "status": { "type": "string", "enum": ["resolved"] },
        "note": { "type": "string", "maxLength": 280 },
        "resolved_at": { "type": "string", "format": "date-time" },
        "url": { "type": "string", "format": "uri" }
      }
    }
  }
}
